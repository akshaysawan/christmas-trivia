<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Party Trivia</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Mountains+of+Christmas:wght@700&family=Poppins:wght@400;600&family=Cinzel:wght@700&family=Pacifico&display=swap" rel="stylesheet">

    <style>
        /* THEME CONFIGURATIONS */
        :root {
            /* Default to Christmas */
            --primary-color: #D42426;       /* Red */
            --secondary-color: #2F5233;     /* Green */
            --accent-color: #F1D570;        /* Gold */
            --text-on-primary: #fff;
            --bg-color: #2F5233;
            --card-bg: rgba(255, 255, 255, 0.95);
            --header-font: 'Mountains of Christmas', cursive;
            --bg-pattern: url("data:image/svg+xml,%3Csvg width='52' height='26' viewBox='0 0 52 26' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M10 10c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4v2c-2.21 0-4-1.79-4-4 0-3.314-2.686-6-6-6-2.21 0-4-1.79-4-4-3.314 0-6-2.686-6-6zM32 22c0-2.21-1.79-4-4-4-3.314 0-6-2.686-6-6h2c0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4 3.314 0 6 2.686 6 6 0 2.21 1.79 4 4 4v2c-2.21 0-4-1.79-4-4-3.314 0-6-2.686-6-6-2.21 0-4-1.79-4-4-3.314 0-6-2.686-6-6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        [data-theme="newyear"] {
            --primary-color: #000000;       /* Black */
            --secondary-color: #B8860B;     /* Dark Gold */
            --accent-color: #FFD700;        /* Gold */
            --text-on-primary: #FFD700;
            --bg-color: #1a1a1a;
            --header-font: 'Cinzel', serif;
            /* Geometric Art Deco Pattern */
            --bg-pattern: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='40' height='40' viewBox='0 0 40 40'%3E%3Cg fill-rule='evenodd'%3E%3Cg fill='%23FFD700' fill-opacity='0.1'%3E%3Cpath d='M0 38.59l2.83-2.83 1.41 1.41L1.41 40H0v-1.41zM0 1.4l2.83 2.83 1.41-1.41L1.41 0H0v1.41zM38.59 40l-2.83-2.83 1.41-1.41L40 38.59V40h-1.41zM40 1.41l-2.83 2.83-1.41-1.41L38.59 0H40v1.41zM20 18.6l2.83-2.83 1.41 1.41L21.41 20l2.83 2.83-1.41 1.41L20 21.41l-2.83 2.83-1.41-1.41L18.59 20l-2.83-2.83 1.41-1.41L20 18.59z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        [data-theme="diwali"] {
            --primary-color: #E65100;       /* Deep Orange */
            --secondary-color: #4A148C;     /* Deep Purple */
            --accent-color: #FFD600;        /* Bright Yellow */
            --text-on-primary: #fff;
            --bg-color: #311B92;            /* Indigo */
            --header-font: 'Poppins', sans-serif; 
            /* Mandala-ish Pattern */
            --bg-pattern: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23FFD600' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        [data-theme="holi"] {
            --primary-color: #E91E63;       /* Pink */
            --secondary-color: #00BCD4;     /* Cyan */
            --accent-color: #FFEB3B;        /* Yellow */
            --text-on-primary: #fff;
            --bg-color: #E91E63;
            --header-font: 'Pacifico', cursive;
            /* Splatter-ish dots */
            --bg-pattern: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.2'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
        }

        body {
            background-color: var(--bg-color);
            background-image: var(--bg-pattern);
            font-family: 'Poppins', sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            transition: background-color 0.5s ease, background-image 0.5s ease;
        }

        .main-card {
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 4px solid var(--accent-color);
            min-height: 60vh;
            position: relative;
            overflow: hidden;
            transition: border-color 0.5s ease;
        }

        .decorative-header {
            background: var(--primary-color);
            color: var(--text-on-primary);
            font-family: var(--header-font);
            padding: 15px;
            text-align: center;
            font-size: 2.5rem;
            position: relative;
            transition: all 0.5s ease;
        }

        /* Generic Decorative Border */
        .decorative-header::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 0;
            width: 100%;
            height: 20px;
            background: radial-gradient(circle, var(--accent-color) 6px, transparent 7px) repeat-x;
            background-size: 30px 20px;
        }

        .top-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .upload-area {
            border: 3px dashed var(--secondary-color);
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background-color: rgba(255, 255, 255, 0.5);
            color: #333;
        }

        .upload-area:hover {
            background-color: rgba(255, 255, 255, 0.8);
            border-color: var(--primary-color);
        }

        .question-text {
            font-size: 2rem;
            font-weight: 600;
            color: var(--secondary-color);
            margin-bottom: 2rem;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.5s ease;
        }

        .answer-box {
            background-color: var(--primary-color);
            color: var(--text-on-primary);
            padding: 20px;
            border-radius: 10px;
            font-size: 1.5rem;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
            transition: all 0.5s ease;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .answer-box.hidden {
            background-color: #e9ecef;
            color: transparent;
            position: relative;
        }

        .answer-box.hidden::after {
            content: 'Click to Reveal Answer';
            color: #6c757d;
            position: absolute;
            font-size: 1rem;
            font-weight: bold;
        }

        .btn-custom {
            border-radius: 50px;
            padding: 10px 30px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: transform 0.2s, background-color 0.5s;
        }

        .btn-custom:hover {
            transform: scale(1.05);
        }

        .btn-next {
            background-color: var(--secondary-color);
            border: none;
            color: white;
        }

        .btn-prev {
            background-color: #6c757d;
            border: none;
            color: white;
        }

        .progress-bar-container {
            height: 10px;
            background-color: #e9ecef;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s ease, background-color 0.5s;
        }

        .snowflake {
            position: fixed;
            top: -10px;
            color: white;
            font-size: 1em;
            animation: fall linear forwards;
            z-index: 1;
            pointer-events: none;
        }

        @keyframes fall {
            to { transform: translateY(105vh); }
        }

        .d-none-custom { display: none !important; }
    </style>
</head>
<body data-theme="christmas">

<!-- Audio Element -->
<audio id="bg-music" loop>
    <source src="" type="audio/ogg">
    Your browser does not support the audio element.
</audio>

<!-- Theme Switcher & Music Toggle -->
<div class="top-controls">
    <button class="btn btn-sm btn-light shadow-sm d-none-custom" id="music-btn" onclick="toggleMusic()">
        <i class="fas fa-music"></i>
    </button>
    <select class="form-select form-select-sm shadow-sm" style="width: auto;" id="themeSelect" onchange="changeTheme(this.value)">
        <option value="christmas" selected>ðŸŽ„ Christmas</option>
        <option value="newyear">ðŸ¥‚ New Year</option>
        <option value="diwali">ðŸª” Diwali</option>
        <option value="holi">ðŸŽ¨ Holi</option>
    </select>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-md-10">
            
            <div class="main-card">
                <div class="decorative-header">
                    <i id="theme-icon" class="fas fa-holly-berry me-2"></i> 
                    <span id="theme-title">Holiday Trivia</span> 
                    <i id="theme-icon-2" class="fas fa-gift ms-2"></i>
                </div>

                <div class="card-body p-4 p-md-5">
                    
                    <!-- ERROR MESSAGE -->
                    <div id="error-message" class="alert alert-danger d-none-custom" role="alert"></div>

                    <!-- SCREEN 1: UPLOAD -->
                    <div id="setup-screen" class="text-center">
                        <h3 class="mb-4" style="color: var(--secondary-color)">Let's Get This Party Started!</h3>
                        <p class="text-muted mb-4">Upload your CSV file to begin. <br>Format: Column 1 = Question, Column 2 = Answer.</p>
                        
                        <div class="upload-area mb-4" id="drop-zone">
                            <i class="fas fa-file-csv fa-4x mb-3" style="color: var(--secondary-color)"></i>
                            <h5>Click to Upload CSV</h5>
                            <p class="text-muted small">or drag and drop file here</p>
                            <input type="file" id="csvFile" accept=".csv" class="d-none">
                        </div>

                        <div class="form-check d-inline-block mb-4">
                            <input class="form-check-input" type="checkbox" value="" id="skipHeader">
                            <label class="form-check-label" for="skipHeader">
                                First row is a header (skip it)
                            </label>
                        </div>

                        <div class="mb-3">
                            <span class="badge bg-success"><i class="fas fa-random me-1"></i> Auto-Shuffle Enabled</span>
                        </div>

                        <div class="mt-3">
                            <small class="text-muted d-block">Need a template?</small>
                            <button class="btn btn-sm btn-outline-secondary mt-1" onclick="downloadTemplate()">Download Sample CSV</button>
                        </div>
                    </div>

                    <!-- SCREEN 2: GAME -->
                    <div id="game-screen" class="d-none-custom text-center">
                        <div class="d-flex justify-content-between text-muted mb-2">
                            <span id="question-counter">Question 1 of 10</span>
                            <span id="score-display">Use arrow keys to navigate</span>
                        </div>
                        
                        <div class="progress-bar-container">
                            <div class="progress-fill" id="progress-bar"></div>
                        </div>

                        <div class="question-text" id="question-display">
                            Loading Question...
                        </div>

                        <div class="answer-box hidden" id="answer-display" onclick="toggleAnswer()">
                            The Answer will appear here
                        </div>

                        <div class="d-flex justify-content-between align-items-center mt-5">
                            <button class="btn btn-custom btn-prev" onclick="prevQuestion()">
                                <i class="fas fa-arrow-left me-2"></i> Prev
                            </button>
                            
                            <button class="btn btn-outline-warning btn-custom" onclick="toggleAnswer()">
                                <i class="fas fa-eye me-2"></i> Show/Hide Answer
                            </button>

                            <button class="btn btn-custom btn-next" onclick="nextQuestion()">
                                Next <i class="fas fa-arrow-right ms-2"></i>
                            </button>
                        </div>
                    </div>

                    <!-- SCREEN 3: END -->
                    <div id="end-screen" class="d-none-custom text-center py-5">
                        <i id="end-icon" class="fas fa-sleigh fa-5x mb-4" style="color: var(--primary-color)"></i>
                        <h2 class="display-4 mb-3" style="font-family: var(--header-font);">That's a Wrap!</h2>
                        <p class="lead mb-5">Hope you had a wonderful time.</p>
                        
                        <button class="btn btn-custom btn-next" onclick="resetGame()">
                            <i class="fas fa-redo me-2"></i> Play Again
                        </button>
                    </div>

                </div>
            </div>

        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

<script>
    // --- State Management ---
    let questions = [];
    let currentQuestionIndex = 0;
    let currentTheme = 'christmas';
    let snowInterval;
    let isMusicPlaying = false;
    
    // --- DOM Elements ---
    const screens = {
        setup: document.getElementById('setup-screen'),
        game: document.getElementById('game-screen'),
        end: document.getElementById('end-screen')
    };
    
    const ui = {
        question: document.getElementById('question-display'),
        answer: document.getElementById('answer-display'),
        counter: document.getElementById('question-counter'),
        progress: document.getElementById('progress-bar'),
        fileInput: document.getElementById('csvFile'),
        dropZone: document.getElementById('drop-zone'),
        skipHeader: document.getElementById('skipHeader'),
        error: document.getElementById('error-message'),
        themeIcon1: document.getElementById('theme-icon'),
        themeIcon2: document.getElementById('theme-icon-2'),
        endIcon: document.getElementById('end-icon'),
        themeTitle: document.getElementById('theme-title'),
        audio: document.getElementById('bg-music'),
        musicBtn: document.getElementById('music-btn')
    };

    // --- Theme Configurations ---
    const themes = {
        christmas: {
            colors: ['#D42426', '#2F5233', '#F1D570'],
            icon: 'fa-holly-berry',
            icon2: 'fa-gift',
            endIcon: 'fa-sleigh',
            snow: true,
            // Local file
            music: 'bgmusic-christmas.mp3' 
        },
        newyear: {
            colors: ['#FFD700', '#C0C0C0', '#000000'],
            icon: 'fa-glass-cheers',
            icon2: 'fa-star',
            endIcon: 'fa-glass-cheers',
            snow: false,
            music: null
        },
        diwali: {
            colors: ['#E65100', '#FFD600', '#4A148C'],
            icon: 'fa-fire', // Diya substitute
            icon2: 'fa-om',
            endIcon: 'fa-fire-alt',
            snow: false,
            music: null
        },
        holi: {
            colors: ['#E91E63', '#00BCD4', '#FFEB3B', '#4CAF50'],
            icon: 'fa-palette',
            icon2: 'fa-hand-sparkles',
            endIcon: 'fa-smile-beam',
            snow: false,
            music: null
        }
    };

    // --- Logic ---

    function changeTheme(themeName) {
        currentTheme = themeName;
        document.body.setAttribute('data-theme', themeName);
        
        const t = themes[themeName];
        
        // Update Icons
        ui.themeIcon1.className = `fas ${t.icon} me-2`;
        ui.themeIcon2.className = `fas ${t.icon2} ms-2`;
        ui.endIcon.className = `fas ${t.endIcon} fa-5x mb-4`;

        // Update Title
        ui.themeTitle.textContent = themeName === 'diwali' ? 'Diwali Trivia' : 
                                    themeName === 'holi' ? 'Holi Trivia' : 
                                    themeName === 'newyear' ? 'New Year Trivia' : 'Holiday Trivia';

        // Manage Snow Effect
        if (t.snow) {
            startSnow();
        } else {
            stopSnow();
        }

        // Manage Music
        if (t.music) {
            ui.musicBtn.classList.remove('d-none-custom');
            ui.audio.src = t.music;
            // Note: Browsers block auto-play. It will only play if user has interacted or clicks the toggle.
            if (isMusicPlaying) {
                ui.audio.play().catch(e => {
                    console.log("Autoplay blocked, waiting for interaction");
                    isMusicPlaying = false;
                    updateMusicBtnUI();
                });
            }
        } else {
            ui.musicBtn.classList.add('d-none-custom');
            ui.audio.pause();
        }
    }

    function toggleMusic() {
        if (ui.audio.paused) {
            ui.audio.play().then(() => {
                isMusicPlaying = true;
                updateMusicBtnUI();
            }).catch(e => console.error("Audio error:", e));
        } else {
            ui.audio.pause();
            isMusicPlaying = false;
            updateMusicBtnUI();
        }
    }

    function updateMusicBtnUI() {
        if (isMusicPlaying) {
            ui.musicBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
            ui.musicBtn.classList.remove('btn-light');
            ui.musicBtn.classList.add('btn-success');
        } else {
            ui.musicBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
            ui.musicBtn.classList.add('btn-light');
            ui.musicBtn.classList.remove('btn-success');
        }
    }

    // --- Standard Game Functions ---

    ui.dropZone.addEventListener('click', () => ui.fileInput.click());
    
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        ui.dropZone.addEventListener(eventName, preventDefaults, false);
    });

    function preventDefaults(e) {
        e.preventDefault();
        e.stopPropagation();
    }

    ['dragenter', 'dragover'].forEach(eventName => {
        ui.dropZone.addEventListener(eventName, () => {
            ui.dropZone.style.backgroundColor = "rgba(255,255,255, 0.8)";
            ui.dropZone.style.borderColor = "var(--primary-color)";
        }, false);
    });

    ['dragleave', 'drop'].forEach(eventName => {
        ui.dropZone.addEventListener(eventName, () => {
            ui.dropZone.style.backgroundColor = "";
            ui.dropZone.style.borderColor = "";
        }, false);
    });

    ui.dropZone.addEventListener('drop', handleDrop, false);
    ui.fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]), false);

    document.addEventListener('keydown', (e) => {
        if (screens.game.classList.contains('d-none-custom')) return;

        if (e.key === "ArrowRight" || e.key === " ") {
            if(ui.answer.classList.contains('hidden')) {
                toggleAnswer();
            } else {
                nextQuestion();
            }
        } else if (e.key === "ArrowLeft") {
            prevQuestion();
        } else if (e.key === "ArrowUp" || e.key === "ArrowDown") {
            toggleAnswer();
        }
    });

    function handleDrop(e) {
        let dt = e.dataTransfer;
        let files = dt.files;
        handleFile(files[0]);
    }

    function handleFile(file) {
        if (!file) return;
        ui.error.classList.add('d-none-custom');
        if (file.type && !file.type.includes('csv') && !file.name.endsWith('.csv')) {
            showError("Please upload a valid CSV file.");
            return;
        }
        Papa.parse(file, {
            complete: function(results) { processData(results.data); },
            error: function(err) { showError("Error parsing CSV: " + err.message); }
        });
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function processData(data) {
        let cleanData = data.filter(row => row.length >= 2 && row[0] !== "" && row[0] !== null);
        if (ui.skipHeader.checked) cleanData.shift();

        if (cleanData.length === 0) {
            showError("No questions found! Check your CSV format.");
            return;
        }

        let rawQuestions = cleanData.map(row => { return { q: row[0], a: row[1] }; });
        questions = shuffleArray(rawQuestions);
        startGame();
    }

    function startGame() {
        currentQuestionIndex = 0;
        switchScreen('game');
        renderQuestion();
    }

    function renderQuestion() {
        if (currentQuestionIndex >= questions.length) {
            endGame();
            return;
        }
        const q = questions[currentQuestionIndex];
        ui.question.style.opacity = 0;
        setTimeout(() => {
            ui.question.textContent = q.q;
            ui.answer.textContent = q.a;
            ui.answer.classList.add('hidden');
            ui.counter.textContent = `Question ${currentQuestionIndex + 1} of ${questions.length}`;
            const percentage = ((currentQuestionIndex + 1) / questions.length) * 100;
            ui.progress.style.width = `${percentage}%`;
            ui.question.style.opacity = 1;
        }, 200);
    }

    function toggleAnswer() {
        if (ui.answer.classList.contains('hidden')) {
            ui.answer.classList.remove('hidden');
            fireConfetti();
        } else {
            ui.answer.classList.add('hidden');
        }
    }

    function nextQuestion() {
        if (currentQuestionIndex < questions.length - 1) {
            currentQuestionIndex++;
            renderQuestion();
        } else {
            endGame();
        }
    }

    function prevQuestion() {
        if (currentQuestionIndex > 0) {
            currentQuestionIndex--;
            renderQuestion();
        }
    }

    function endGame() {
        switchScreen('end');
        fireConfetti(true);
    }

    function resetGame() {
        ui.fileInput.value = '';
        questions = [];
        switchScreen('setup');
    }

    function switchScreen(screenName) {
        Object.values(screens).forEach(el => el.classList.add('d-none-custom'));
        screens[screenName].classList.remove('d-none-custom');
    }

    function showError(msg) {
        ui.error.textContent = msg;
        ui.error.classList.remove('d-none-custom');
    }

    function downloadTemplate() {
        const csvContent = "data:text/csv;charset=utf-8," 
            + "Question,Answer\n"
            + "Question 1,Answer 1\n"
            + "Question 2,Answer 2";
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", "trivia_template.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function fireConfetti(isBig = false) {
        const colors = themes[currentTheme].colors;
        if (isBig) {
            var duration = 3000;
            var end = Date.now() + duration;
            (function frame() {
            confetti({ particleCount: 7, angle: 60, spread: 55, origin: { x: 0 }, colors: colors });
            confetti({ particleCount: 7, angle: 120, spread: 55, origin: { x: 1 }, colors: colors });
            if (Date.now() < end) requestAnimationFrame(frame);
            }());
        } else {
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: colors });
        }
    }

    // --- Snow Effect ---
    function createSnowflake() {
        const snowflake = document.createElement('div');
        snowflake.innerHTML = 'â„';
        snowflake.classList.add('snowflake');
        snowflake.style.left = Math.random() * 100 + 'vw';
        snowflake.style.animationDuration = Math.random() * 3 + 5 + 's';
        snowflake.style.opacity = Math.random();
        snowflake.style.fontSize = Math.random() * 20 + 10 + 'px';
        document.body.appendChild(snowflake);
        
        setTimeout(() => { snowflake.remove(); }, 8000);
    }

    function startSnow() {
        if (!snowInterval) {
            snowInterval = setInterval(createSnowflake, 300);
        }
    }

    function stopSnow() {
        if (snowInterval) {
            clearInterval(snowInterval);
            snowInterval = null;
        }
        document.querySelectorAll('.snowflake').forEach(el => el.remove());
    }

    // Initialize
    // Set initial music source, but don't play until user interacts
    if(themes.christmas.music) {
        ui.audio.src = themes.christmas.music;
        ui.musicBtn.classList.remove('d-none-custom');
        updateMusicBtnUI();
    }
    startSnow(); 
</script>

</body>
</html>